# Notes:
#
# We use fmt -2000 to combine all the arguments into a single line.
# There is an upper limit on the line length supported by the Linux
# version of fmt; on Mac the limit is higher.
#
# We use /etc/mailname as an easy way of getting the hostname that
# RMI will use to tag objects returned from this host.  This must
# be a hostname that can be resolved from the hosts where the
# Logic Monitor collector agents are running.
JAVA_HOME=$(readlink -f /usr/lib/jvm/default-java | sed "s:bin/java::")
CATALINA_BASE=/data/var
CATALINA_OUT=/data/log/tomcat/catalina.out
CATALINA_TMPDIR=/data/tmp
CATALINA_PID=<%= node['tomcat']['pid_file'] %>
CATALINA_OPTS=$(fmt -2000 <<EOF
$CATALINA_OPTS
-server
$(test -r <%=node['tomcat']['dir']%>/tcell/tcellagent.jar && echo -javaagent:<%=node['tomcat']['dir']%>/tcell/tcellagent.jar)
-Xms<%= node['tomcat']['heap_initial'] %>
-Xmx<%= node['tomcat']['heap_max'] %>
-Xss256k
-XX:+UseG1GC
-XX:+StartAttachListener
-Dspring.profiles.active=<%= node['tomcat']['spring_profiles'] %>
-Dfile.encoding=UTF-8
-Djava.net.preferIPv4Stack=true
-Djava.rmi.server.hostname=$(curl http://169.254.169.254/latest/meta-data/local-hostname)
-Djava.io.tmpdir=<%= node['tomcat']['tmp_dir'] %>
-Dcom.sun.management.jmxremote
-Dcom.sun.management.jmxremote.port=1099
-Dcom.sun.management.jmxremote.rmi.port=1099
-Dcom.sun.management.jmxremote.authenticate=false
-Dcom.sun.management.jmxremote.ssl=false
-Djgroups.bind_addr=match-interface:eth.*
EOF
)
