<match raw.postfix.maillog>
  @type copy
   <store>
    @type rewrite_tag_filter
    <rule>
    key message
    pattern  (\.<%= @region %>.compute\.internal|table hash:|sm-msp-queue)
    tag clear
    </rule>
    <rule>
      key message
      pattern .+
      tag sophos.xgemail.<%= @application_name %>.maillog
    </rule>
   </store>
   <store>
    @type stdout
  </store>
  <store>
    @type rewrite_tag_filter
    <rule>
      key message
      pattern ([^ ]+) ([^\/]+\/smtpd\[\d+\]): ([^ ]+): (reject): ((RCPT from ([^ ]+)\[([^ ]+)\]:) (554 5.7.1 Service unavailable); (Client host \S* is blacklisted). (([^;]+)); from=<(([^>]+)(@(\S*)))> to=<(([^>]+)(@(\S*)))> proto=([^ ]+) helo=<(([^>]+))>)
      tag sns.reject.XGEMAIL_0004
    </rule>
    <rule>
      key message
      pattern ([^ ]+) ([^\/]+\/smtpd\[\d+\]): ([^ ]+): (reject): ((RCPT from ([^ ]+)\[([^ ]+)\]:) (554 5.7.1 Service unavailable); (Sender address \S* blocked using \S*.sophosxl.com); from=<(([^>]+)(@(\S*)))> to=<(([^>]+)(@(\S*)))> proto=([^ ]+) helo=<(([^>]+))>)
      tag sns.reject.XGEMAIL_0005
    </rule>
    <rule>
      key message
      pattern /XGEMAIL_0001/
      tag sns.reject.XGEMAIL_0001
    </rule>
    <rule>
      key message
      pattern /XGEMAIL-002/
      tag sns.reject.XGEMAIL_0002
    </rule>
    <rule>
      key message
      pattern /XGEMAIL-003/
      tag sns.reject.XGEMAIL_0003
    </rule>
  </store>
</match>

<match clear>
  @type null
</match>