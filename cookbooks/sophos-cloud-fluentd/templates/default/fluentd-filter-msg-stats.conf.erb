<filter sns.reject.rbl_reject>
  @type parser
  key_name message
  reserve_data true
  reserve_time true
  <parse>
    @type regexp
    expression /^(?<host>[^ ]+) (?<process>[^\/]+\/smtpd\[\d+\]): (?<qid>[^ ]+): (?<action>reject): (?<msg>(RCPT from (?<sender_host>[^ ]+)\[(?<sender_ip>[^ ]+)\]:) (?<code>554 5.7.1 Service unavailable); (?<reason>Client host \S* is blacklisted). (?<delist>([^;]+)); from=<(?<sender_address>([^>]+)(@(?<sender_domain>\S*)))> to=<(?<rcpt_address>([^>]+)(@(?<rcpt_domain>\S*)))> proto=(?<proto>[^ ]+) helo=<(?<helo_address>([^>]+))>)/
  </parse>
</filter>
<filter sns.reject.enterprise_blocked>
  @type parser
  key_name message
  reserve_data true
  reserve_time true
  <parse>
    @type regexp
    expression /^(?<host>[^ ]+) (?<process>[^\/]+\/smtpd\[\d+\]): (?<qid>[^ ]+): (?<action>reject): (?<msg>(RCPT from (?<sender_host>[^ ]+)\[(?<sender_ip>[^ ]+)\]:) (?<code>554 5.7.1 Service unavailable); (?<reason>Sender address \S* blocked using \S*.sophosxl.com); from=<(?<sender_address>([^>]+)(@(?<sender_domain>\S*)))> to=<(?<rcpt_address>([^>]+)(@(?<rcpt_domain>\S*)))> proto=(?<proto>[^ ]+) helo=<(?<helo_address>([^>]+))>)/
  </parse>
</filter>
<filter sns.reject.auth_failure>
  @type parser
  key_name message
  reserve_data true
  reserve_time true
  <parse>
    @type regexp
    expression /^(?<host>[^ ]+) (?<process>[^ ]+): (?<qid>[^ ]+): (?<action>[^ ]+): (?<msg>[^ ]+ from (?<sender_host>[^ ]+)\[(?<sender_ip>[^ ]+)\]: (?<code>[^;]+); from=<(?<sender_address>(?<sender>[^>]+)@(?<sender_domain>\S*))> to=<(?<rcpt_address>(?<rcpt>[^>]+)@(?<rcpt_domain>\S*))> proto=(?<proto>[^ ]+) helo=<(?<helo_address>[^>]+)>)/
  </parse>
</filter>

<filter sns.reject.*>
  @type record_transformer
  <record>
    message_rejection_code ${tag_suffix[2]}
  </record>
</filter>