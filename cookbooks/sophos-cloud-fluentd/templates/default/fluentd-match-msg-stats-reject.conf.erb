#
# XGEMAIL_0004
# Mar  9 03:59:43 ip-172-20-0-4 postfix-is/smtpd[1237]: NOQUEUE: reject: SOPHOS_UUID_ba19915c-4973-4504-a1c9-aea5d1931d99: RCPT from unknown[91.216.61.22]: 554 5.7.1 Service unavailable; Client host [91.216.61.22] is blacklisted. Visit https://www.sophos.com/en-us/threat-center/ip-lookup.aspx?ip=91.216.61.22 to request delisting; from=<badguy@bad-domain.com> to=<recipient@sophos-email-customer.com> proto=ESMTP helo=<[91.216.61.22]>
#
# XGEMAIL_0005
# Mar  9 03:59:43 ip-172-20-0-4 postfix-is/smtpd[1237]: NOQUEUE: reject: SOPHOS_UUID_ba19915c-4973-4504-a1c9-aea5d1931d99: RCPT from unknown[192.210.213.76]: 554 5.7.1 Service unavailable; Sender address [badguy@bad-domain.com] blocked using uri.ire1.sophosxl.com; from=<badguy@bad-domain.com> to=<recipient@sophos-email-customer.com> proto=ESMTP helo=<bad-domain.com>
#

<match raw.maillog.log>
  @type copy
  <store>
    @type rewrite_tag_filter
    <rule>
      key message
      pattern  <%= @maillog_filter_patterns %>
      tag clear
    </rule>
    <rule>
      key message
      pattern .+
      tag sophos.xgemail.<%= @application_name %>.maillog
    </rule>
  </store>
  <store>
    @type rewrite_tag_filter
    <rule>
      key message
      pattern ([^ ]+) ([^\/]+\/smtpd\[\d+\]): ([^ ]+): (reject): (SOPHOS_UUID_[^ ]+): ((RCPT from ([^ ]+)\[([^ ]+)\]:) (554 5.7.1 Service unavailable); (Client host \S* is blacklisted). (([^;]+)); from=<(([^>]+)(@(\S*)))> to=<(([^>]+)(@(\S*)))>.*)
      tag sns.msg_stats_reject.XGEMAIL_0004
    </rule>
    <rule>
      key message
      pattern ([^ ]+) ([^\/]+\/smtpd\[\d+\]): ([^ ]+): (reject): (SOPHOS_UUID_[^ ]+): ((RCPT from ([^ ]+)\[([^ ]+)\]:) (554 5.7.1 Service unavailable); (Sender address \S* blocked using \S*.sophosxl.com); from=<(([^>]+)(@(\S*)))> to=<(([^>]+)(@(\S*)))>.*)
      tag sns.msg_stats_reject.XGEMAIL_0005
    </rule>
  </store>
</match>

<match clear>
  @type null
</match>
