<match mhv2.**>
  @type http
  endpoint http://localhost:8983/delivery_event
  open_timeout 2
  json_array true
  retryable_response_codes [503]
  <format>
    @type json
  </format>
  <buffer>
    @type file_single
    path /var/log/td-agent/out_http_msg_history
    flush_interval 2s                 # flush output interval; this will batch the requests

    # the below values apply in case of failure when calling http endpoint
    retry_wait 10s                    # The wait interval for the first retry.
    retry_exponential_backoff_base 2  # Increase the wait time by a factor of N.
    retry_type exponential_backoff    # Set 'periodic' for constant intervals.

    retry_max_interval 1h             # Cap the wait interval.
    retry_randomize true              # Apply randomization.
    retry_timeout 6h                  # Maximum duration before giving up.

    retry_max_times 5                 # Maximum retry count before giving up.
    retry_forever false               # Set 'true' for infinite retry loops.
  </buffer>
</match>
