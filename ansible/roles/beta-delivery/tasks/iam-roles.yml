---
# CloudEmail IAM Roles for Beta delivery Instances
- name: "Deploy {{stack.iam.role.cloud_email_beta_delivery_roles}} to {{account.name}} {{account.region}}"
  cloudformation:
    stack_name:                                 "{{stack.iam.role.cloud_email_beta_delivery_roles}}"
    state:                                      present
    region:                                     "{{account.region}}"
    disable_rollback:                           true
    template:                                   "{{template.iam.role.roles_beta_delivery_template}}"
    template_parameters:
      Environment:                              "{{account.name}}"
      XgemailMsgHistoryBucketName:              "{{s3.msg_history_bucket}}"
      XgemailMsgHistoryMsBucketName:            "{{s3.msg_history_ms_bucket}}"
      XgemailPolicyBucketName:                  "{{s3.policy_bucket}}"
      XgemailQuarantineBucketName:              "{{s3.quarantine_bucket}}"
      XgemailInternetSubmitBucketName:          "{{s3.internet_submit_bucket}}"
      XgemailCustomerSubmitBucketName:          "{{s3.customer_submit_bucket}}"
      DeliveryDirectorDynamodbTableName:        "{{dynamodb.delivery_director_dynamodb}}"
      DeliveryDirectorBucketName:               "{{s3.delivery_director_bucket}}"
  register: cloud_email_beta_iam_output

- name: "Gather {{stack.iam.role.cloud_email_beta_delivery_roles}} CloudFormation Stack Output"
  cloudformation_facts:
    stack_name: "{{stack.iam.role.cloud_email_beta_delivery_roles}}"
    region: "{{account.region}}"
  register: cloud_email_beta_iam_output

- name: "Print {{stack.iam.role.cloud_email_beta_delivery_roles}} CloudFormation Stack Output"
  debug:
    var: cloud_email_beta_iam_output
    verbosity: 3