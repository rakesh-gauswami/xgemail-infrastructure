- name: "Deploy {{stack.msg.xgemail_messaging}} to {{account.name}} {{account.region}}"
  cloudformation:
    stack_name: "{{stack.msg.xgemail_messaging}}"
    state: present
    region: "{{account.region}}"
    disable_rollback: true
    template: "{{template.msg.xgemail_messaging_template}}"
    template_parameters:
      DeletedEventsTopicArn:                            "{{sns.arn_prefix}}{{sns.deleted_events_sns_topic}}"
      DelayTopicArn:                                    "{{sns.arn_prefix}}{{sns.delay_sns_topic}}"
      DelayQueue:                                       "{{sqs.delay_sqs_queue}}"
      QuarantinedEventsTopicArn:                        "{{sns.arn_prefix}}{{sns.quarantined_events_sns_topic}}"
      SuccessEventsTopicArn:                            "{{sns.arn_prefix}}{{sns.success_events_sns_topic}}"
      DeliveryQueue:                                    "{{sqs.customer_delivery_sqs_queue_sns_listener}}"
      EncryptionDeliveryEventsTopicArn:                 "{{sns.arn_prefix}}{{sns.encryption_delivery_events_sns_topic}}"
      EncryptionDeliveryQueue:                          "{{sqs.encryption_delivery_sqs_queue_sns_listener}}"
      EncryptEventsTopicArn:                            "{{sns.arn_prefix}}{{sns.encrypt_events_sns_topic}}"
      EmergencyInboxQueue:                              "{{sqs.emergency_inbox_sqs_queue_sns_listener}}"
      ImpersonationRequestQueue:                        "{{sqs.impersonation_request_queue}}"
      ImpersonationResponseQueue:                       "{{sqs.impersonation_response_queue}}"
      InternetDeliveryTopicArn:                         "{{sns.arn_prefix}}{{sns.internet_delivery_sns_topic}}"
      InternetDeliveryQueue:                            "{{sqs.internet_delivery_sqs_queue_sns_listener}}"
      InternetSubmitServiceQueue:                       "{{sqs.internet_submit_service_sqs_queue}}"
      MessageHistoryEventsTopicArn:                     "{{sns.arn_prefix}}{{sns.msg_history_events_sns_topic}}"
      MessageHistoryStatusQueue:                        "{{sqs.msg_history_status_sqs_queue_sns_listener}}"
      MessageHistoryStatusQueueTopicArn:                "{{sns.arn_prefix}}{{sns.msg_history_status_sns_topic}}"
      MessageHistoryQueue:                              "{{sqs.msg_history_sqs_queue_sns_listener}}"
      MessageStatisticsQueue:                           "{{sqs.msg_statistics_sqs_queue_sns_listener}}"
      MessageStatisticsRejectionTopicArn:               "{{sns.arn_prefix}}{{sns.msg_statistics_rejection_sns_topic}}"
      MessageStatisticsRejectionQueue:                  "{{sqs.msg_statistics_rejection_sqs_queue}}"
      QuarantineQueue:                                  "{{sqs.quarantine_sqs_queue_sns_listener}}"
      MultiPolicyQueue:                                 "{{sqs.multi_policy_sqs_queue}}"
      MultiPolicyTopicArn:                              "{{sns.arn_prefix}}{{sns.multi_policy_sns_topic}}"
      NotifierQueueTopicArn:                            "{{sns.arn_prefix}}{{sns.notification_sns_topic}}"
      NotifierQueue:                                    "{{sqs.notifier_request_sqs_queue}}"
      OutboundMalwareProtectionQueue:                   "{{sqs.outbound_malware_protection_queue_sns_listener}}"
      OutboundMalwareProtectionUnblockSenderQueue:      "{{sqs.outbound_malware_protection_unblock_sender_queue}}"
      ScanEventsTopicArn:                               "{{sns.arn_prefix}}{{sns.scan_events_sns_topic}}"
      BounceEventTopicArn:                              "{{sns.arn_prefix}}{{sns.bounce_events_sns_topic}}"
      BounceEventQueue:                                 "{{sqs.message_bounce_sqs_queue_sns_listener}}"
      RedirectEventTopicArn:                            "{{sns.arn_prefix}}{{sns.redirect_events_sns_topic}}"
      RedirectEventQueue:                               "{{sqs.message_redirect_sqs_queue_sns_listener}}"
      AdditionalActionTopicArn:                         "{{sns.arn_prefix}}{{sns.additional_actions_sns_topic}}"
      AdditionalActionQueue:                            "{{sqs.additional_action_sqs_queue_sns_listener}}"
      AdditionalActionQueueUrl:                         "{{sqs.url_prefix}}{{sqs.additional_action_sqs_queue_sns_listener}}"
      RiskyDeliveryTopicArn:                            "{{sns.arn_prefix}}{{sns.risky_delivery_sns_topic}}"
      RiskyDeliveryQueue:                               "{{sqs.risky_delivery_sqs_queue_sns_listener}}"
  register: messaging_stack

- debug:
    var: messaging_stack
    verbosity: 3

- name: "Display Xgemail Messaging Stack Output"
  debug:
    msg: "{{messaging_stack.stack_outputs}}"
    verbosity: 2
