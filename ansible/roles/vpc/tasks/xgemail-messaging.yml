- name: "Deploy {{stack.msg.xgemail_messaging}} to {{account.name}} {{account.region}}"
  cloudformation:
    stack_name: "{{stack.msg.xgemail_messaging}}"
    state: present
    region: "{{account.region}}"
    disable_rollback: true
    template: "{{template.msg.xgemail_messaging_template}}"
    template_parameters:
      DeletedEventsTopicArn:                  "{{sns.arn_prefix}}{{sns.deleted_events_sns_topic}}"
      DelayTopicArn:                          "{{sns.arn_prefix}}{{sns.delay_sns_topic}}"
      DelayQueueArn:                          "{{sqs.arn_prefix}}{{sqs.delay_sqs_queue}}"
      DelayQueueUrl:                          "{{sqs.url_prefix}}{{sqs.delay_sqs_queue}}"
      QuarantinedEventsTopicArn:              "{{sns.arn_prefix}}{{sns.quarantined_events_sns_topic}}"
      SuccessEventsTopicArn:                  "{{sns.arn_prefix}}{{sns.success_events_sns_topic}}"
      DeliveryQueueArn:                       "{{sqs.arn_prefix}}{{sqs.customer_delivery_sqs_queue_sns_listener}}"
      DeliveryQueueUrl:                       "{{sqs.url_prefix}}{{sqs.customer_delivery_sqs_queue_sns_listener}}"
      EmergencyInboxQueueArn:                 "{{sqs.arn_prefix}}{{sqs.emergency_inbox_sqs_queue_sns_listener}}"
      EmergencyInboxQueueUrl:                 "{{sqs.url_prefix}}{{sqs.emergency_inbox_sqs_queue_sns_listener}}"
      InternetDeliveryTopicArn:               "{{sns.arn_prefix}}{{sns.internet_delivery_sns_topic}}"
      InternetDeliveryQueueArn:               "{{sqs.arn_prefix}}{{sqs.internet_delivery_sqs_queue_sns_listener}}"
      InternetDeliveryQueueUrl:               "{{sqs.url_prefix}}{{sqs.internet_delivery_sqs_queue_sns_listener}}"
      MessageHistoryQueueArn:                 "{{sqs.arn_prefix}}{{sqs.msg_history_sqs_queue_sns_listener}}"
      MessageHistoryQueueUrl:                 "{{sqs.url_prefix}}{{sqs.msg_history_sqs_queue_sns_listener}}"
      MessageStatisticsQueueArn:              "{{sqs.arn_prefix}}{{sqs.msg_statistics_sqs_queue_sns_listener}}"
      MessageStatisticsQueueUrl:              "{{sqs.url_prefix}}{{sqs.msg_statistics_sqs_queue_sns_listener}}"
      MessageStatisticsRejectionTopicArn:     "{{sns.arn_prefix}}{{sns.msg_statistics_rejection_sns_topic}}"
      MessageStatisticsRejectionQueueArn:     "{{sqs.arn_prefix}}{{sqs.msg_statistics_rejection_sqs_queue}}"
      MessageStatisticsRejectionQueueUrl:     "{{sqs.url_prefix}}{{sqs.msg_statistics_rejection_sqs_queue}}"
      QuarantineQueueArn:                     "{{sqs.arn_prefix}}{{sqs.quarantine_sqs_queue_sns_listener}}"
      QuarantineQueueUrl:                     "{{sqs.url_prefix}}{{sqs.quarantine_sqs_queue_sns_listener}}"
      MultiPolicyQueueArn:                    "{{sqs.arn_prefix}}{{sqs.multi_policy_sqs_queue}}"
      MultiPolicyQueueUrl:                    "{{sqs.url_prefix}}{{sqs.multi_policy_sqs_queue}}"
      MultiPolicyTopicArn:                    "{{sns.arn_prefix}}{{sns.multi_policy_sns_topic}}"
  register: messaging_stack

- debug:
    var: messaging_stack
    verbosity: 3

- name: "Display Xgemail Messaging Stack Output"
  debug:
    msg: "{{messaging_stack.stack_outputs}}"
    verbosity: 2